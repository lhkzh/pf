!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).play_msg={})}(this,(function(r){"use strict";var e;r.MType=void 0,(e=r.MType||(r.MType={}))[e.BOOL=0]="BOOL",e[e.I8=1]="I8",e[e.I16=2]="I16",e[e.I32=3]="I32",e[e.I64=4]="I64",e[e.I53=5]="I53",e[e.F32=6]="F32",e[e.F64=7]="F64",e[e.STR=8]="STR",e[e.DATE=9]="DATE";var n=new Map,t=new Map,i=new Map,o=1,a=function(r){return BigInt(r)},f=function(){function e(){}return e.prototype.toString=function(){return"[Class:".concat(this.constructor.name,"]=>").concat(T.Stringify((r=this,e=new WeakMap,function r(n,t){var i,o;if(!("object"!=typeof n||null===n||n instanceof Boolean||n instanceof Date||n instanceof Number||n instanceof RegExp||n instanceof String)){if(void 0!==(i=e.get(n)))return{$ref:i};if(e.set(n,t),n instanceof Set)n=Array.from(n);else if(n instanceof Map){var a={};n.forEach((function(r,e){a[e]=r})),n=a}return Array.isArray(n)?(o=[],n.forEach((function(e,n){o[n]=r(e,t+"["+n+"]")}))):(o={},Object.keys(n).forEach((function(e){o[e]=r(n[e],t+"["+JSON.stringify(e)+"]")}))),o}return n}(r,"$"))));var r,e},e.prototype.toArray=function(r){return this.constructor.ToArray(this,r)},e.prototype.toRefArray=function(){return this.constructor.ToRefArray(this)},e.CastByArray=function(r,e){return r.FromArray(e)},e.CastByRefArray=function(r,e){return r.FromRefArray(e)},e.ToArray=function(r,e){return null==r?null:r.constructor.ToArray(r,e)},e.FromArray=function(r){return null},e.ToRefArray=function(r){return null==r?null:r.constructor.ToRefArray(r)},e.FromRefArray=function(r){return null},e.ClassByName=function(r){var e;return null===(e=n.get(r))||void 0===e?void 0:e.clazz},e.ClassById=function(r){var e;return null===(e=t.get(r))||void 0===e?void 0:e.clazz},e.MetaByName=function(r){return n.get(r)},e.MetaById=function(r){return t.get(r)},e.MetaByClass=function(r){return i.get(r)},e.MetaIdList=function(){var r=[];return t.forEach((function(e,n){r.push(n)})),r},e.MetaNameList=function(){var r=[];return n.forEach((function(e,n){r.push(n)})),r},Object.defineProperty(e,"CastInt64",{get:function(){return a},set:function(r){a=r||a},enumerable:!1,configurable:!0}),e.Meta=function(r){return function(n){e.MetaBind(n,r.id||o++,r.name||n.name,r.fields)}},e.MetaBind=function(e,o,a,f){if(t.has(o)||n.has(a))throw new TypeError("MsgInfo.(id or name).conflict:"+o+"_"+a);var y=Object.freeze({id:o,name:a,fields:f,clazz:e});t.set(o,y),n.set(a,y),i.set(e,y),e.ToArray=function(e,n){if(void 0===n&&(n=8),null==e)return null;if(n<0)throw new Error("max stack limit: check circle reference");for(var t=new Array(f.length),i=function(){var i=e[f[o][0]],a=f[o][1];if(i)if(a.ToArray)i=a.ToArray(i,n-1);else if(Array.isArray(a))if("Arr"==a[0])a[1].ToArray&&(i=i.map((function(r){return a[1].ToArray(r,n-1)})));else if("Set"==a[0]){var u=[];a[1].ToArray?i.forEach((function(r){u.push(a[1].ToArray(r,n-1))})):i.forEach((function(r){u.push(r)})),i=u}else if("Obj"==a[0]){var y=[],c=Object.keys(i);a[2].ToArray?c.forEach((function(e){y.push(a[1]!=r.MType.STR?Number(e):e,a[2].ToArray(i[e],n-1))})):c.forEach((function(e){y.push(a[1]!=r.MType.STR?Number(e):e,i[e])})),i=y}else{if("Map"!=a[0])throw new TypeError("NOT implemented:"+a[0]);var s=[];a[2].ToArray?i.forEach((function(r,e){s.push(e,a[2].ToArray(r,n-1))})):i.forEach((function(r,e){s.push(e,r)})),i=s}t[o]=i},o=0;o<t.length;o++)i();return t},e.FromArray=function(r){if(null==r)return null;if(!Array.isArray(r))throw new TypeError("Decode Fail-0:".concat(a));for(var n=new e,t=0;t<f.length;t++)n[f[t][0]]=u(r[t],a,f[t]);return n},e.ToRefArray=function(e,n,t){if(void 0===n&&(n=new Map),void 0===t&&(t=""),null==e)return null;if(n.has(e))return n.get(e);n.set(e,t);for(var i=new Array(f.length),o=function(){var o=e[f[a][0]],u=f[a][1],y=t+"."+a.toString(36);if(o)if(u.ToArray)o=u.ToRefArray(o,n,y);else if(Array.isArray(u))if(n.has(o))o=n.get(o);else if(n.set(o,y),"Arr"==u[0])u[1].ToArray&&(o=o.map((function(r,e){return u[1].ToRefArray(r,n,y+"."+e.toString(36))})));else if("Set"==u[0]){var c=[];u[1].ToArray?o.forEach((function(r,e){c.push(u[1].ToRefArray(r,n,y+"."+e.toString(36)))})):o.forEach((function(r){c.push(r)})),o=c}else if("Obj"==u[0]){var s=[],p=Object.keys(o);u[2].ToArray?p.forEach((function(e){s.push(u[1]!=r.MType.STR?Number(e):e,u[2].ToRefArray(o[e],n,y+"."+s.length.toString(36)))})):p.forEach((function(e){s.push(u[1]!=r.MType.STR?Number(e):e,o[e])})),o=s}else{if("Map"!=u[0])throw new TypeError("NOT implemented:"+u[0]);var l=[];u[2].ToArray?o.forEach((function(r,e){l.push(e,u[2].ToRefArray(r,n,y+"."+l.length.toString(36)))})):o.forEach((function(r,e){l.push(e,r)})),o=l}i[a]=o},a=0;a<i.length;a++)o();return i},e.FromRefArray=function(r,n,t){if(void 0===n&&(n=new Map),void 0===t&&(t=""),null==r)return null;if(!Array.isArray(r)){if("string"==typeof r&&n.has(r))return n.get(r);throw new TypeError("Decode Fail-0:".concat(a))}var i=new e;n.set(t,i);for(var o=0;o<f.length;o++)i[f[o][0]]=c(r[o],a,f[o],n,t+"."+o.toString(36));return i}},e.ConfigTypedArray=function(r){var e=[Int8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];"undefined"!=typeof BigInt&&e.push(BigInt64Array,BigUint64Array),r?e.forEach((function(r){r.ToArray=function(r){for(var e=new Array(r.length),n=0;n<r.length;n++)e[n]=r[n];return e}})):e.forEach((function(r){r.ToArray=null,delete r.ToArray}))},e}();function u(e,n,t){var i=t[0],o=t[1];if(null==e){if(1==t[2])throw new TypeError("Decode Fail-(need require):".concat(n,".").concat(i));if(Number.isInteger(o)){if(o>=r.MType.I8&&o<=r.MType.F64)return o==r.MType.I64?a(0):0;if(o==r.MType.STR)return""}else if(Array.isArray(o)){var f=o;if("Arr"==f[0])return[];if("Obj"==f[0])return{};if("Set"==f[0])return new Set;if("Map"==f[0])return new Map}else if(o.BYTES_PER_ELEMENT>0)return new o;return e}if(Number.isInteger(o))return p(e,o,n,i);if(Array.isArray(o)){Array.isArray(e)||l(n,i);var u=o;if("Arr"==u[0])return e.map((function(r){return y(r,u[1],n,i)}));if("Obj"==u[0]){for(var c={},s=0;s<e.length;s+=2)c[p(e[s],u[1],n,i)]=y(e[s+1],u[2],n,i);return c}if("Set"==u[0])return new Set(e.map((function(r){return y(r,u[1],n,i)})));if("Map"==u[0]){var A=new Map;for(s=0;s<e.length;s+=2)A.set(p(e[s],u[1],n,i),y(e[s+1],u[2],n,i));return A}}else{if(!(o.BYTES_PER_ELEMENT>0))return o.FromArray(e);if(Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return new o(e);if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new o(e);l(n,i)}}function y(e,n,t,i){return r.MType[n]?p(e,n,t,i):n.FromArray(e)}function c(e,n,t,i,o){void 0===o&&(o="");var f=t[0],u=t[1];if(null==e){if(1==t[2])throw new TypeError("Decode Fail-(need require):".concat(n,".").concat(f));if(Number.isInteger(u)){if(u>=r.MType.I8&&u<=r.MType.F64)return u==r.MType.I64?a(0):0;if(u==r.MType.STR)return""}else if(Array.isArray(u)){var y=u;if("Arr"==y[0])return[];if("Obj"==y[0])return{};if("Set"==y[0])return new Set;if("Map"==y[0])return new Map}else if(u.BYTES_PER_ELEMENT>0)return new u;return e}if(Number.isInteger(u))return p(e,u,n,f);if(Array.isArray(u)){if(!Array.isArray(e)){if("string"==typeof e&&i.has(e))return i.get(e);l(n,f)}var c=u,A=void 0;if("Arr"==c[0])A=e.map((function(r,e){return s(r,c[1],n,f,i,o+"."+e.toString(36))}));else if("Obj"==c[0]){for(var T={},d=0;d<e.length;d+=2)T[p(e[d],c[1],n,f)]=s(e[d+1],c[2],n,f,i,o+"."+d.toString(36));A=T}else if("Set"==c[0])A=new Set(e.map((function(r,e){return s(r,c[1],n,f,i,o+"."+e.toString(36))})));else if("Map"==c[0]){var h=new Map;for(d=0;d<e.length;d+=2)h.set(p(e[d],c[1],n,f),s(e[d+1],c[2],n,f,i,o+"."+d.toString(36)));A=h}return i.set(o,A),A}return u.BYTES_PER_ELEMENT>0?Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?new u(e):void l(n,f):u.FromRefArray(e,i,o)}function s(e,n,t,i,o,a){return r.MType[n]?p(e,n,t,i):n.FromRefArray(e,o,a)}function p(e,n,t,i){return n==r.MType.I64?e=a(e):n>=r.MType.I8&&n<=r.MType.F64?(e=Number(e),Number.isFinite(e)||l(t,i)):n==r.MType.BOOL?e=Boolean(e):n==r.MType.DATE?e instanceof Date==0&&l(t,i):n==r.MType.STR&&"string"!=typeof e&&l(t,i),e}function l(r,e){throw new TypeError("Decode Fail-2:".concat(r,".").concat(e))}var A="__$FIELDS$__";var T=function(){function r(){}return r.Stringify=function(r,e){return JSON.stringify(r,d,e)},r.Parse=function(r){return JSON.parse(r,h)},r}();function d(r,e){return"bigint"==typeof e?{type:"bigint",data:e.toString()}:e instanceof Map?{type:"Map",data:Array.from(e.entries())}:e instanceof Set?{type:"Set",data:Array.from(e)}:e&&e.buffer instanceof ArrayBuffer?{type:e.constructor.name,data:Array.from(e)}:e}function h(r,e){if("string"==typeof e){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(e))return new Date(Date.parse(e))}else if(null!=e&&"object"==typeof e&&"string"==typeof e.type&&e.data){if("bigint"==e.type)return f.CastInt64(e.data);if("Map"==e.type)return new Map(e.data);if("Set"==e.type)return new Set(e.data);if(e.type.lastIndexOf("Array")>0)return new g[e.type](e.data)}return e}var g="object"==typeof window?window:global;r.JsonX=T,r.MsgArray=f,r.MsgClass=function(r,e){return function(n){f.MetaBind(n,r||o++,e||n.name,n.prototype[A]||[]),delete n.prototype[A]}},r.MsgField=function(r,e,n){return void 0===e&&(e=0),function(t,i){t[A]||(t[A]=[]),t[A].push([n||i.toString(),r,e])}},Object.defineProperty(r,"__esModule",{value:!0})}));
