!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).play_msg={})}(this,(function(r){"use strict";var e,t;r.MtBase=void 0,(e=r.MtBase||(r.MtBase={}))[e.BOOL=0]="BOOL",e[e.I8=1]="I8",e[e.I16=2]="I16",e[e.I32=3]="I32",e[e.I64=4]="I64",e[e.I53=5]="I53",e[e.F32=6]="F32",e[e.F64=7]="F64",e[e.STR=8]="STR",e[e.DATE=9]="DATE",r.MtBox=void 0,(t=r.MtBox||(r.MtBox={}))[t.Obj=11]="Obj",t[t.Arr=12]="Arr",t[t.Map=13]="Map",t[t.Set=14]="Set";var n=new Map,o=new Map,a=new Map,i=1,f=function(r){return BigInt(r)},u=function(){function e(){}return e.prototype.toString=function(){return"[Class:".concat(this.constructor.name,"]=>").concat(h.Stringify((r=this,e=new WeakMap,function r(t,n){var o,a;if(!("object"!=typeof t||null===t||t instanceof Boolean||t instanceof Date||t instanceof Number||t instanceof RegExp||t instanceof String)){if(void 0!==(o=e.get(t)))return{$ref:o};if(e.set(t,n),t instanceof Set)t=Array.from(t);else if(t instanceof Map){var i={};t.forEach((function(r,e){i[e]=r})),t=i}return Array.isArray(t)?(a=[],t.forEach((function(e,t){a[t]=r(e,n+"["+t+"]")}))):(a={},Object.keys(t).forEach((function(e){a[e]=r(t[e],n+"["+JSON.stringify(e)+"]")}))),a}return t}(r,"$"))));var r,e},e.prototype.toArray=function(r){return this.constructor.ToArray(this,r)},e.prototype.toRefArray=function(){return this.constructor.ToRefArray(this)},e.CastByArray=function(r,e){return r.FromArray(e)},e.CastByRefArray=function(r,e){return r.FromRefArray(e)},e.ToArray=function(r,e){return null==r?null:r.constructor.ToArray(r,e)},e.FromArray=function(r){return null},e.ToRefArray=function(r){return null==r?null:r.constructor.ToRefArray(r)},e.FromRefArray=function(r){return null},e.ClassByName=function(r){var e;return null===(e=n.get(r))||void 0===e?void 0:e.clazz},e.ClassById=function(r){var e;return null===(e=o.get(r))||void 0===e?void 0:e.clazz},e.MetaByName=function(r){return n.get(r)},e.MetaById=function(r){return o.get(r)},e.MetaByClass=function(r){return a.get(r)},e.MetaIdList=function(){var r=[];return o.forEach((function(e,t){r.push(t)})),r},e.MetaNameList=function(){var r=[];return n.forEach((function(e,t){r.push(t)})),r},Object.defineProperty(e,"CastInt64",{get:function(){return f},set:function(r){f=r||f},enumerable:!1,configurable:!0}),e.Meta=function(r){return function(t){e.MetaBind(t,r.id||i++,r.name||t.name,r.fields)}},e.MetaBind=function(t,i,f,u){if(o.has(i)||n.has(f))throw new TypeError("MsgInfo.(id or name).conflict:"+i+"_"+f);var c=Object.freeze({id:i,name:f,fields:u,clazz:t});o.set(i,c),n.set(f,c),a.set(t,c),t.ToArray=function(t,n){if(void 0===n&&(n=8),null==t)return null;if(n<0)throw new Error("max stack limit: check circle reference");for(var o=new Array(u.length),a=function(){var a=t[u[i][0]],c=u[i][1];if(a){if(c.ToArray)a=c.ToArray(a,n-1);else if(Array.isArray(c))if(c[0]==r.MtBox.Arr)c[1].ToArray&&(a=a.map((function(r){return c[1].ToArray(r,n-1)})));else if(c[0]==r.MtBox.Set){var s=[];c[1].ToArray?a.forEach((function(r){s.push(c[1].ToArray(r,n-1))})):a.forEach((function(r){s.push(r)})),a=s}else if(c[0]==r.MtBox.Obj){var y=[],l=Object.keys(a);c[2].ToArray?l.forEach((function(e){y.push(c[1]!=r.MtBase.STR?Number(e):e,c[2].ToArray(a[e],n-1))})):l.forEach((function(e){y.push(c[1]!=r.MtBase.STR?Number(e):e,a[e])})),a=y}else{if(c[0]!=r.MtBox.Map)throw new TypeError("NOT implemented:"+c[0]);var A=[];c[2].ToArray?a.forEach((function(r,e){A.push(e,c[2].ToArray(r,n-1))})):a.forEach((function(r,e){A.push(e,r)})),a=A}}else if(e.CHECK.OUT&&1==u[i][2])throw new TypeError("Decode Fail-(need require):".concat(f,".").concat(u[i][0]));o[i]=a},i=0;i<o.length;i++)a();return o},t.FromArray=function(r){if(null==r)return null;if(!Array.isArray(r))throw new TypeError("Decode Fail-0:".concat(f));for(var e=new t,n=0;n<u.length;n++)e[u[n][0]]=s(r[n],f,u[n]);return e},t.ToRefArray=function(t,n,o){if(void 0===n&&(n=new Map),void 0===o&&(o=""),null==t)return null;if(n.has(t))return n.get(t);n.set(t,o);for(var a=new Array(u.length),i=function(){var i=t[u[c][0]],s=u[c][1],y=o+"."+c.toString(36);if(i){if(s.ToArray)i=s.ToRefArray(i,n,y);else if(Array.isArray(s))if(n.has(i))i=n.get(i);else if(n.set(i,y),s[0]==r.MtBox.Arr)s[1].ToArray&&(i=i.map((function(r,e){return s[1].ToRefArray(r,n,y+"."+e.toString(36))})));else if(s[0]==r.MtBox.Set){var l=[];s[1].ToArray?i.forEach((function(r,e){l.push(s[1].ToRefArray(r,n,y+"."+e.toString(36)))})):i.forEach((function(r){l.push(r)})),i=l}else if(s[0]==r.MtBox.Obj){var A=[],p=Object.keys(i);s[2].ToArray?p.forEach((function(e){A.push(s[1]!=r.MtBase.STR?Number(e):e,s[2].ToRefArray(i[e],n,y+"."+A.length.toString(36)))})):p.forEach((function(e){A.push(s[1]!=r.MtBase.STR?Number(e):e,i[e])})),i=A}else{if(s[0]!=r.MtBox.Map)throw new TypeError("NOT implemented:"+s[0]);var d=[];s[2].ToArray?i.forEach((function(r,e){d.push(e,s[2].ToRefArray(r,n,y+"."+d.length.toString(36)))})):i.forEach((function(r,e){d.push(e,r)})),i=d}}else if(e.CHECK.OUT&&1==u[c][2])throw new TypeError("Decode Fail-(need require):".concat(f,".").concat(u[c][0]));a[c]=i},c=0;c<a.length;c++)i();return a},t.FromRefArray=function(r,e,n){if(void 0===e&&(e=new Map),void 0===n&&(n=""),null==r)return null;if(!Array.isArray(r)){if("string"==typeof r&&e.has(r))return e.get(r);throw new TypeError("Decode Fail-0:".concat(f))}var o=new t;e.set(n,o);for(var a=0;a<u.length;a++)o[u[a][0]]=l(r[a],f,u[a],e,n+"."+a.toString(36));return o}},e.OptionTypedArray=function(r){var e=[Int8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];"undefined"!=typeof BigInt&&e.push(BigInt64Array,BigUint64Array),r?e.forEach((function(r){r.ToArray=function(r){for(var e=new Array(r.length),t=0;t<r.length;t++)e[t]=r[t];return e}})):e.forEach((function(r){r.ToArray=null,delete r.ToArray}))},e.CHECK={OUT:!1,IN:!0},e}();function c(e){if(Number.isInteger(e)){if(e>=r.MtBase.I8&&e<=r.MtBase.F64)return e==r.MtBase.I64?f(0):0;if(e==r.MtBase.STR)return""}else if(Array.isArray(e)){var t=e;if(t[0]==r.MtBox.Arr)return[];if(t[0]==r.MtBox.Obj)return{};if(t[0]==r.MtBox.Set)return new Set;if(t[0]==r.MtBox.Map)return new Map}else if(e.BYTES_PER_ELEMENT>0)return new e;return null}function s(e,t,n){var o=n[0],a=n[1];if(null==e){if(u.CHECK.IN&&1==n[2])throw new TypeError("Decode Fail-(need require):".concat(t,".").concat(o));return c(a)}if(Number.isInteger(a))return p(e,a,t,o);if(Array.isArray(a)){Array.isArray(e)||d(t,o);var i=a;if(i[0]==r.MtBox.Arr)return e.map((function(r){return y(r,i[1],t,o)}));if(i[0]==r.MtBox.Obj){for(var f={},s=0;s<e.length;s+=2)f[p(e[s],i[1],t,o)]=y(e[s+1],i[2],t,o);return f}if(i[0]==r.MtBox.Set)return new Set(e.map((function(r){return y(r,i[1],t,o)})));if(i[0]==r.MtBox.Map){var l=new Map;for(s=0;s<e.length;s+=2)l.set(p(e[s],i[1],t,o),y(e[s+1],i[2],t,o));return l}}else{if(!(a.BYTES_PER_ELEMENT>0))return a.FromArray(e);if(Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return new a(e);if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new a(e);d(t,o)}}function y(e,t,n,o){return r.MtBase[t]?p(e,t,n,o):t.FromArray(e)}function l(e,t,n,o,a){void 0===a&&(a="");var i=n[0],f=n[1];if(null==e){if(u.CHECK.IN&&1==n[2])throw new TypeError("Decode Fail-(need require):".concat(t,".").concat(i));return c(f)}if(Number.isInteger(f))return p(e,f,t,i);if(Array.isArray(f)){if(!Array.isArray(e)){if("string"==typeof e&&o.has(e))return o.get(e);d(t,i)}var s=f,y=void 0;if(s[0]==r.MtBox.Arr)y=e.map((function(r,e){return A(r,s[1],t,i,o,a+"."+e.toString(36))}));else if(s[0]==r.MtBox.Obj){for(var l={},M=0;M<e.length;M+=2)l[p(e[M],s[1],t,i)]=A(e[M+1],s[2],t,i,o,a+"."+M.toString(36));y=l}else if(s[0]==r.MtBox.Set)y=new Set(e.map((function(r,e){return A(r,s[1],t,i,o,a+"."+e.toString(36))})));else if(s[0]==r.MtBox.Map){var h=new Map;for(M=0;M<e.length;M+=2)h.set(p(e[M],s[1],t,i),A(e[M+1],s[2],t,i,o,a+"."+M.toString(36)));y=h}return o.set(a,y),y}return f.BYTES_PER_ELEMENT>0?Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?new f(e):void d(t,i):f.FromRefArray(e,o,a)}function A(e,t,n,o,a,i){return r.MtBase[t]?p(e,t,n,o):t.FromRefArray(e,a,i)}function p(e,t,n,o){return t==r.MtBase.I64?e=f(e):t>=r.MtBase.I8&&t<=r.MtBase.F64?(e=Number(e),Number.isFinite(e)||d(n,o)):t==r.MtBase.BOOL?e=Boolean(e):t==r.MtBase.DATE?e instanceof Date==0&&d(n,o):t==r.MtBase.STR&&"string"!=typeof e&&d(n,o),e}function d(r,e){throw new TypeError("Decode Fail-2:".concat(r,".").concat(e))}var M="__$FIELDS$__";var h=function(){function r(){}return r.Stringify=function(r,e){return JSON.stringify(r,B,e)},r.Parse=function(r){return JSON.parse(r,g)},r}();function B(r,e){return"bigint"==typeof e?{type:"bigint",data:e.toString()}:e instanceof Map?{type:"Map",data:Array.from(e.entries())}:e instanceof Set?{type:"Set",data:Array.from(e)}:e&&e.buffer instanceof ArrayBuffer?{type:e.constructor.name,data:Array.from(e)}:e}function g(r,e){if("string"==typeof e){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(e))return new Date(Date.parse(e))}else if(null!=e&&"object"==typeof e&&"string"==typeof e.type&&e.data){if("bigint"==e.type)return u.CastInt64(e.data);if("Map"==e.type)return new Map(e.data);if("Set"==e.type)return new Set(e.data);if(e.type.lastIndexOf("Array")>0)return new T[e.type](e.data)}return e}var T="object"==typeof window?window:global;r.JsonX=h,r.MsgArray=u,r.MsgClass=function(r,e){return function(t){u.MetaBind(t,r||i++,e||t.name,t.prototype[M]||[]),delete t.prototype[M]}},r.MsgField=function(r,e,t){return void 0===e&&(e=0),function(n,o){n[M]||(n[M]=[]),n[M].push([t||o.toString(),r,e])}},Object.defineProperty(r,"__esModule",{value:!0})}));
