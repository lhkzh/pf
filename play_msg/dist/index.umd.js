!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).play_msg={})}(this,(function(r){"use strict";var e;r.MT=void 0,(e=r.MT||(r.MT={}))[e.BOOL=0]="BOOL",e[e.BYTE=1]="BYTE",e[e.SHORT=2]="SHORT",e[e.INT=3]="INT",e[e.LONG=4]="LONG",e[e.I53=5]="I53",e[e.FLOAT=6]="FLOAT",e[e.DOUBLE=7]="DOUBLE",e[e.STR=8]="STR",e[e.DATE=9]="DATE",e[e.OBJ=10]="OBJ",e[e.ARR=11]="ARR",e[e.MAP=12]="MAP",e[e.SET=13]="SET";const t=new Map,n=new Map,a=new Map;let i=0,o=r=>--i,f=r=>BigInt(r);class s{static CHECK={OUT:!1,IN:!0};toString(){return`[Class:${this.constructor.name}]=>${M.Stringify((r=this,e=new WeakMap,function r(t,n){var a,i;if(!("object"!=typeof t||null===t||t instanceof Boolean||t instanceof Date||t instanceof Number||t instanceof RegExp||t instanceof String)){if(void 0!==(a=e.get(t)))return{$ref:a};if(e.set(t,n),t instanceof Set)t=Array.from(t);else if(t instanceof Map){var o={};t.forEach(((r,e)=>{o[e]=r})),t=o}return Array.isArray(t)?(i=[],t.forEach((function(e,t){i[t]=r(e,n+"["+t+"]")}))):(i={},Object.keys(t).forEach((function(e){i[e]=r(t[e],n+"["+JSON.stringify(e)+"]")}))),i}return t}(r,"$")))}`;var r,e}toArray(r){return this.constructor.ToArray(this,r)}toRefArray(){return this.constructor.ToRefArray(this)}static CastByArray(r,e){return r.FromArray(e)}static CastByRefArray(r,e){return r.FromRefArray(e)}static ToArray(r,e){return null==r?null:r.constructor.ToArray(r,e)}static FromArray(r){return null}static ToRefArray(r){return null==r?null:r.constructor.ToRefArray(r)}static FromRefArray(r){return null}static ClassByName(r){return t.get(r)?.clazz}static ClassById(r){return n.get(r)?.clazz}static MetaByName(r){return t.get(r)}static MetaById(r){return n.get(r)}static MetaByClass(r){return a.get(r)}static MetaIdList(){let r=[];return n.forEach(((e,t)=>{r.push(t)})),r}static MetaNameList(){let r=[];return t.forEach(((e,t)=>{r.push(t)})),r}static set CastInt64(r){f=r||f}static get CastInt64(){return f}static set NextId(r){o=r||o}static Meta(r){return function(e){let t=r.name||e.name;s.MetaBind(e,r.id||o(t),t,r.fields)}}static MetaBind(e,i,o,f){if(n.has(i)||t.has(o))throw new TypeError("MsgInfo.(id or name).conflict:"+i+"_"+o);const u=Object.freeze({id:i,name:o,fields:f,clazz:e});n.set(i,u),t.set(o,u),a.set(e,u),e.ToJSON=function(e,t=8){if(null==e)return null;if(t<0)throw new Error("max stack limit: check circle reference");let n={};for(var a=0;a<f.length;a++){let i=f[a],u=e[i[0]],l=i[1];if(u)l.ToJSON&&(u=l.ToJSON(u,t-1));else if(Array.isArray(l))if(l[0]==r.MT.ARR)l[1].ToJSON&&(u=u.map((r=>l[1].ToJSON(r,t-1))));else if(l[0]==r.MT.SET){let r=[];l[1].ToJSON?u.forEach((e=>{r.push(l[1].ToJSON(e,t-1))})):u.forEach((e=>{r.push(e)})),u=r}else if(l[0]==r.MT.OBJ){let e=[],n=Object.keys(u);l[2].ToJSON?n.forEach((n=>{e.push(l[1]!=r.MT.STR?Number(n):n,l[2].ToJSON(u[n],t-1))})):n.forEach((t=>{e.push(l[1]!=r.MT.STR?Number(t):t,u[t])})),u=e}else{if(l[0]!=r.MT.MAP)throw new TypeError("NOT implemented:"+l[0]);{let r=[];l[2].ToJSON?u.forEach(((e,n)=>{r.push(n,l[2].ToJSON(e,t-1))})):u.forEach(((e,t)=>{r.push(t,e)})),u=r}}else if(s.CHECK.OUT&&1==f[a][2])throw new TypeError(`Decode Fail-(need require):${o}.${f[a][0]}`);n[i[0]]=u}return n},e.ToArray=function(e,t=8){if(null==e)return null;if(t<0)throw new Error("max stack limit: check circle reference");let n=new Array(f.length);for(var a=0;a<n.length;a++){let i=e[f[a][0]],u=f[a][1];if(i){if(u.ToArray)i=u.ToArray(i,t-1);else if(Array.isArray(u))if(u[0]==r.MT.ARR)u[1].ToArray&&(i=i.map((r=>u[1].ToArray(r,t-1))));else if(u[0]==r.MT.SET){let r=[];u[1].ToArray?i.forEach((e=>{r.push(u[1].ToArray(e,t-1))})):i.forEach((e=>{r.push(e)})),i=r}else if(u[0]==r.MT.OBJ){let e=[],n=Object.keys(i);u[2].ToArray?n.forEach((n=>{e.push(u[1]!=r.MT.STR?Number(n):n,u[2].ToArray(i[n],t-1))})):n.forEach((t=>{e.push(u[1]!=r.MT.STR?Number(t):t,i[t])})),i=e}else{if(u[0]!=r.MT.MAP)throw new TypeError("NOT implemented:"+u[0]);{let r=[];u[2].ToArray?i.forEach(((e,n)=>{r.push(n,u[2].ToArray(e,t-1))})):i.forEach(((e,t)=>{r.push(t,e)})),i=r}}}else if(s.CHECK.OUT&&1==f[a][2])throw new TypeError(`Decode Fail-(need require):${o}.${f[a][0]}`);n[a]=i}return n},e.FromArray=function(r){if(null==r)return null;if(!Array.isArray(r))throw new TypeError(`Decode Fail-0:${o}`);let t=new e;for(var n=0;n<f.length;n++)t[f[n][0]]=l(r[n],o,f[n]);return t},e.ToRefArray=function(e,t=new Map,n=""){if(null==e)return null;if(t.has(e))return t.get(e);t.set(e,n);let a=new Array(f.length);for(var i=0;i<a.length;i++){let u=e[f[i][0]],l=f[i][1],y=n+"."+i.toString(36);if(u){if(l.ToArray)u=l.ToRefArray(u,t,y);else if(Array.isArray(l))if(t.has(u))u=t.get(u);else if(t.set(u,y),l[0]==r.MT.ARR)l[1].ToArray&&(u=u.map(((r,e)=>l[1].ToRefArray(r,t,y+"."+e.toString(36)))));else if(l[0]==r.MT.SET){let r=[];l[1].ToArray?u.forEach(((e,n)=>{r.push(l[1].ToRefArray(e,t,y+"."+n.toString(36)))})):u.forEach((e=>{r.push(e)})),u=r}else if(l[0]==r.MT.OBJ){let e=[],n=Object.keys(u);l[2].ToArray?n.forEach((n=>{e.push(l[1]!=r.MT.STR?Number(n):n,l[2].ToRefArray(u[n],t,y+"."+e.length.toString(36)))})):n.forEach((t=>{e.push(l[1]!=r.MT.STR?Number(t):t,u[t])})),u=e}else{if(l[0]!=r.MT.MAP)throw new TypeError("NOT implemented:"+l[0]);{let r=[];l[2].ToArray?u.forEach(((e,n)=>{r.push(n,l[2].ToRefArray(e,t,y+"."+r.length.toString(36)))})):u.forEach(((e,t)=>{r.push(t,e)})),u=r}}}else if(s.CHECK.OUT&&1==f[i][2])throw new TypeError(`Decode Fail-(need require):${o}.${f[i][0]}`);a[i]=u}return a},e.FromRefArray=function(r,t=new Map,n=""){if(null==r)return null;if(!Array.isArray(r)){if("string"==typeof r&&t.has(r))return t.get(r);throw new TypeError(`Decode Fail-0:${o}`)}let a=new e;t.set(n,a);for(var i=0;i<f.length;i++)a[f[i][0]]=T(r[i],o,f[i],t,n+"."+i.toString(36));return a}}static OptionTypedArray(r){let e=[Int8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];"undefined"!=typeof BigInt&&e.push(BigInt64Array,BigUint64Array),r?e.forEach((r=>{r.ToArray=function(r){let e=new Array(r.length);for(let t=0;t<r.length;t++)e[t]=r[t];return e}})):e.forEach((r=>{r.ToArray=null,delete r.ToArray}))}}function u(e){if(Number.isInteger(e)){if(e>=r.MT.BYTE&&e<=r.MT.DOUBLE)return e==r.MT.LONG?f(0):0;if(e==r.MT.STR)return"";if(e==r.MT.BOOL)return!1}else if(Array.isArray(e)){let t=e;if(t[0]==r.MT.ARR)return[];if(t[0]==r.MT.OBJ)return{};if(t[0]==r.MT.SET)return new Set;if(t[0]==r.MT.MAP)return new Map}else if(e.BYTES_PER_ELEMENT>0)return new e;return null}function l(e,t,n){const a=n[0],i=n[1];if(null==e){if(s.CHECK.IN&&1==n[2])throw new TypeError(`Decode Fail-(need require):${t}.${a}`);return n.length>3?n[4]:u(i)}if(Number.isInteger(i))return A(e,i,t,a);if(Array.isArray(i)){Array.isArray(e)||p(t,a);let n=i;if(n[0]==r.MT.ARR)return e.map((r=>y(r,n[1],t,a)));if(n[0]==r.MT.OBJ){let r={};for(let i=0;i<e.length;i+=2)r[A(e[i],n[1],t,a)]=y(e[i+1],n[2],t,a);return r}if(n[0]==r.MT.SET)return new Set(e.map((r=>y(r,n[1],t,a))));if(n[0]==r.MT.MAP){let r=new Map;for(let i=0;i<e.length;i+=2)r.set(A(e[i],n[1],t,a),y(e[i+1],n[2],t,a));return r}}else{if(!(i.BYTES_PER_ELEMENT>0))return i.FromArray(e);if(Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return new i(e);if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new i(e);p(t,a)}}function y(e,t,n,a){return t<r.MT.OBJ?A(e,t,n,a):t.FromArray(e)}function T(e,t,n,a,i=""){const o=n[0],f=n[1];if(null==e){if(s.CHECK.IN&&1==n[2])throw new TypeError(`Decode Fail-(need require):${t}.${o}`);return u(f)}if(Number.isInteger(f))return A(e,f,t,o);if(Array.isArray(f)){if(!Array.isArray(e)){if("string"==typeof e&&a.has(e))return a.get(e);p(t,o)}let n,s=f;if(s[0]==r.MT.ARR)n=e.map(((r,e)=>c(r,s[1],t,o,a,i+"."+e.toString(36))));else if(s[0]==r.MT.OBJ){let r={};for(let n=0;n<e.length;n+=2)r[A(e[n],s[1],t,o)]=c(e[n+1],s[2],t,o,a,i+"."+n.toString(36));n=r}else if(s[0]==r.MT.SET)n=new Set(e.map(((r,e)=>c(r,s[1],t,o,a,i+"."+e.toString(36)))));else if(s[0]==r.MT.MAP){let r=new Map;for(let n=0;n<e.length;n+=2)r.set(A(e[n],s[1],t,o),c(e[n+1],s[2],t,o,a,i+"."+n.toString(36)));n=r}return a.set(i,n),n}return f.BYTES_PER_ELEMENT>0?Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?new f(e):void p(t,o):f.FromRefArray(e,a,i)}function c(e,t,n,a,i,o){return t<r.MT.OBJ?A(e,t,n,a):t.FromRefArray(e,i,o)}function A(e,t,n,a){return t==r.MT.LONG?e=f(e):t>=r.MT.BYTE&&t<=r.MT.DOUBLE?(e=Number(e),Number.isFinite(e)||p(n,a)):t==r.MT.BOOL?e=Boolean(e):t==r.MT.DATE?e instanceof Date==0&&p(n,a):t==r.MT.STR&&"string"!=typeof e&&p(n,a),e}function p(r,e){throw new TypeError(`Decode Fail-2:${r}.${e}`)}const h=Symbol("__$FIELDS$__");class M{static Stringify(r,e){return JSON.stringify(r,E,e)}static Parse(r){return JSON.parse(r,d)}}function E(r,e){return"bigint"==typeof e?{type:"bigint",data:e.toString()}:e instanceof Map?{type:"Map",data:Array.from(e.entries())}:e instanceof Set?{type:"Set",data:Array.from(e)}:e&&e.buffer instanceof ArrayBuffer?{type:e.constructor.name,data:Array.from(e)}:e}function d(r,e){if("string"==typeof e){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(e))return new Date(Date.parse(e))}else if(null!=e&&"object"==typeof e&&"string"==typeof e.type&&e.data){if("bigint"==e.type)return s.CastInt64(e.data);if("Map"==e.type)return new Map(e.data);if("Set"==e.type)return new Set(e.data);if(e.type.lastIndexOf("Array")>0)return new g[e.type](e.data)}return e}const g="object"==typeof window?window:global;r.JsonX=M,r.MsgArray=s,r.MsgClass=function(r,e){return function(t){let n=e||t.name;s.MetaBind(t,r||o(n),n,t.prototype[h]||[]),delete t.prototype[h]}},r.MsgField=function(r,e=0,t){return function(n,a){n[h]||(n[h]=[]),n[h].push([t||a.toString(),r,e])}},Object.defineProperty(r,"__esModule",{value:!0})}));
