!function(r,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((r="undefined"!=typeof globalThis?globalThis:r||self).play_msg={})}(this,(function(r){"use strict";var e;r.MT=void 0,(e=r.MT||(r.MT={}))[e.BOOL=0]="BOOL",e[e.BYTE=1]="BYTE",e[e.SHORT=2]="SHORT",e[e.INT=3]="INT",e[e.LONG=4]="LONG",e[e.I53=5]="I53",e[e.FLOAT=6]="FLOAT",e[e.DOUBLE=7]="DOUBLE",e[e.STR=8]="STR",e[e.DATE=9]="DATE",e[e.OBJ=10]="OBJ",e[e.ARR=11]="ARR",e[e.MAP=12]="MAP",e[e.SET=13]="SET";const t=new Map,n=new Map,a=new Map;let i=1,o=r=>BigInt(r);class f{static CHECK={OUT:!1,IN:!0};toString(){return`[Class:${this.constructor.name}]=>${M.Stringify((r=this,e=new WeakMap,function r(t,n){var a,i;if(!("object"!=typeof t||null===t||t instanceof Boolean||t instanceof Date||t instanceof Number||t instanceof RegExp||t instanceof String)){if(void 0!==(a=e.get(t)))return{$ref:a};if(e.set(t,n),t instanceof Set)t=Array.from(t);else if(t instanceof Map){var o={};t.forEach(((r,e)=>{o[e]=r})),t=o}return Array.isArray(t)?(i=[],t.forEach((function(e,t){i[t]=r(e,n+"["+t+"]")}))):(i={},Object.keys(t).forEach((function(e){i[e]=r(t[e],n+"["+JSON.stringify(e)+"]")}))),i}return t}(r,"$")))}`;var r,e}toArray(r){return this.constructor.ToArray(this,r)}toRefArray(){return this.constructor.ToRefArray(this)}static CastByArray(r,e){return r.FromArray(e)}static CastByRefArray(r,e){return r.FromRefArray(e)}static ToArray(r,e){return null==r?null:r.constructor.ToArray(r,e)}static FromArray(r){return null}static ToRefArray(r){return null==r?null:r.constructor.ToRefArray(r)}static FromRefArray(r){return null}static ClassByName(r){return t.get(r)?.clazz}static ClassById(r){return n.get(r)?.clazz}static MetaByName(r){return t.get(r)}static MetaById(r){return n.get(r)}static MetaByClass(r){return a.get(r)}static MetaIdList(){let r=[];return n.forEach(((e,t)=>{r.push(t)})),r}static MetaNameList(){let r=[];return t.forEach(((e,t)=>{r.push(t)})),r}static set CastInt64(r){o=r||o}static get CastInt64(){return o}static Meta(r){return function(e){f.MetaBind(e,r.id||i++,r.name||e.name,r.fields)}}static MetaBind(e,i,o,s){if(n.has(i)||t.has(o))throw new TypeError("MsgInfo.(id or name).conflict:"+i+"_"+o);const y=Object.freeze({id:i,name:o,fields:s,clazz:e});n.set(i,y),t.set(o,y),a.set(e,y),e.ToArray=function(e,t=8){if(null==e)return null;if(t<0)throw new Error("max stack limit: check circle reference");let n=new Array(s.length);for(var a=0;a<n.length;a++){let i=e[s[a][0]],u=s[a][1];if(i){if(u.ToArray)i=u.ToArray(i,t-1);else if(Array.isArray(u))if(u[0]==r.MT.ARR)u[1].ToArray&&(i=i.map((r=>u[1].ToArray(r,t-1))));else if(u[0]==r.MT.SET){let r=[];u[1].ToArray?i.forEach((e=>{r.push(u[1].ToArray(e,t-1))})):i.forEach((e=>{r.push(e)})),i=r}else if(u[0]==r.MT.OBJ){let e=[],n=Object.keys(i);u[2].ToArray?n.forEach((n=>{e.push(u[1]!=r.MT.STR?Number(n):n,u[2].ToArray(i[n],t-1))})):n.forEach((t=>{e.push(u[1]!=r.MT.STR?Number(t):t,i[t])})),i=e}else{if(u[0]!=r.MT.MAP)throw new TypeError("NOT implemented:"+u[0]);{let r=[];u[2].ToArray?i.forEach(((e,n)=>{r.push(n,u[2].ToArray(e,t-1))})):i.forEach(((e,t)=>{r.push(t,e)})),i=r}}}else if(f.CHECK.OUT&&1==s[a][2])throw new TypeError(`Decode Fail-(need require):${o}.${s[a][0]}`);n[a]=i}return n},e.FromArray=function(r){if(null==r)return null;if(!Array.isArray(r))throw new TypeError(`Decode Fail-0:${o}`);let t=new e;for(var n=0;n<s.length;n++)t[s[n][0]]=u(r[n],o,s[n]);return t},e.ToRefArray=function(e,t=new Map,n=""){if(null==e)return null;if(t.has(e))return t.get(e);t.set(e,n);let a=new Array(s.length);for(var i=0;i<a.length;i++){let u=e[s[i][0]],y=s[i][1],l=n+"."+i.toString(36);if(u){if(y.ToArray)u=y.ToRefArray(u,t,l);else if(Array.isArray(y))if(t.has(u))u=t.get(u);else if(t.set(u,l),y[0]==r.MT.ARR)y[1].ToArray&&(u=u.map(((r,e)=>y[1].ToRefArray(r,t,l+"."+e.toString(36)))));else if(y[0]==r.MT.SET){let r=[];y[1].ToArray?u.forEach(((e,n)=>{r.push(y[1].ToRefArray(e,t,l+"."+n.toString(36)))})):u.forEach((e=>{r.push(e)})),u=r}else if(y[0]==r.MT.OBJ){let e=[],n=Object.keys(u);y[2].ToArray?n.forEach((n=>{e.push(y[1]!=r.MT.STR?Number(n):n,y[2].ToRefArray(u[n],t,l+"."+e.length.toString(36)))})):n.forEach((t=>{e.push(y[1]!=r.MT.STR?Number(t):t,u[t])})),u=e}else{if(y[0]!=r.MT.MAP)throw new TypeError("NOT implemented:"+y[0]);{let r=[];y[2].ToArray?u.forEach(((e,n)=>{r.push(n,y[2].ToRefArray(e,t,l+"."+r.length.toString(36)))})):u.forEach(((e,t)=>{r.push(t,e)})),u=r}}}else if(f.CHECK.OUT&&1==s[i][2])throw new TypeError(`Decode Fail-(need require):${o}.${s[i][0]}`);a[i]=u}return a},e.FromRefArray=function(r,t=new Map,n=""){if(null==r)return null;if(!Array.isArray(r)){if("string"==typeof r&&t.has(r))return t.get(r);throw new TypeError(`Decode Fail-0:${o}`)}let a=new e;t.set(n,a);for(var i=0;i<s.length;i++)a[s[i][0]]=l(r[i],o,s[i],t,n+"."+i.toString(36));return a}}static OptionTypedArray(r){let e=[Int8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];"undefined"!=typeof BigInt&&e.push(BigInt64Array,BigUint64Array),r?e.forEach((r=>{r.ToArray=function(r){let e=new Array(r.length);for(let t=0;t<r.length;t++)e[t]=r[t];return e}})):e.forEach((r=>{r.ToArray=null,delete r.ToArray}))}}function s(e){if(Number.isInteger(e)){if(e>=r.MT.BYTE&&e<=r.MT.DOUBLE)return e==r.MT.LONG?o(0):0;if(e==r.MT.STR)return"";if(e==r.MT.BOOL)return!1}else if(Array.isArray(e)){let t=e;if(t[0]==r.MT.ARR)return[];if(t[0]==r.MT.OBJ)return{};if(t[0]==r.MT.SET)return new Set;if(t[0]==r.MT.MAP)return new Map}else if(e.BYTES_PER_ELEMENT>0)return new e;return null}function u(e,t,n){const a=n[0],i=n[1];if(null==e){if(f.CHECK.IN&&1==n[2])throw new TypeError(`Decode Fail-(need require):${t}.${a}`);return n.length>3?n[4]:s(i)}if(Number.isInteger(i))return T(e,i,t,a);if(Array.isArray(i)){Array.isArray(e)||A(t,a);let n=i;if(n[0]==r.MT.ARR)return e.map((r=>y(r,n[1],t,a)));if(n[0]==r.MT.OBJ){let r={};for(let i=0;i<e.length;i+=2)r[T(e[i],n[1],t,a)]=y(e[i+1],n[2],t,a);return r}if(n[0]==r.MT.SET)return new Set(e.map((r=>y(r,n[1],t,a))));if(n[0]==r.MT.MAP){let r=new Map;for(let i=0;i<e.length;i+=2)r.set(T(e[i],n[1],t,a),y(e[i+1],n[2],t,a));return r}}else{if(!(i.BYTES_PER_ELEMENT>0))return i.FromArray(e);if(Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)return new i(e);if("undefined"!=typeof Buffer&&Buffer.isBuffer(e))return new i(e);A(t,a)}}function y(e,t,n,a){return t<r.MT.OBJ?T(e,t,n,a):t.FromArray(e)}function l(e,t,n,a,i=""){const o=n[0],u=n[1];if(null==e){if(f.CHECK.IN&&1==n[2])throw new TypeError(`Decode Fail-(need require):${t}.${o}`);return s(u)}if(Number.isInteger(u))return T(e,u,t,o);if(Array.isArray(u)){if(!Array.isArray(e)){if("string"==typeof e&&a.has(e))return a.get(e);A(t,o)}let n,f=u;if(f[0]==r.MT.ARR)n=e.map(((r,e)=>c(r,f[1],t,o,a,i+"."+e.toString(36))));else if(f[0]==r.MT.OBJ){let r={};for(let n=0;n<e.length;n+=2)r[T(e[n],f[1],t,o)]=c(e[n+1],f[2],t,o,a,i+"."+n.toString(36));n=r}else if(f[0]==r.MT.SET)n=new Set(e.map(((r,e)=>c(r,f[1],t,o,a,i+"."+e.toString(36)))));else if(f[0]==r.MT.MAP){let r=new Map;for(let n=0;n<e.length;n+=2)r.set(T(e[n],f[1],t,o),c(e[n+1],f[2],t,o,a,i+"."+n.toString(36)));n=r}return a.set(i,n),n}return u.BYTES_PER_ELEMENT>0?Array.isArray(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||"undefined"!=typeof Buffer&&Buffer.isBuffer(e)?new u(e):void A(t,o):u.FromRefArray(e,a,i)}function c(e,t,n,a,i,o){return t<r.MT.OBJ?T(e,t,n,a):t.FromRefArray(e,i,o)}function T(e,t,n,a){return t==r.MT.LONG?e=o(e):t>=r.MT.BYTE&&t<=r.MT.DOUBLE?(e=Number(e),Number.isFinite(e)||A(n,a)):t==r.MT.BOOL?e=Boolean(e):t==r.MT.DATE?e instanceof Date==0&&A(n,a):t==r.MT.STR&&"string"!=typeof e&&A(n,a),e}function A(r,e){throw new TypeError(`Decode Fail-2:${r}.${e}`)}const p="__$FIELDS$__";class M{static Stringify(r,e){return JSON.stringify(r,h,e)}static Parse(r){return JSON.parse(r,E)}}function h(r,e){return"bigint"==typeof e?{type:"bigint",data:e.toString()}:e instanceof Map?{type:"Map",data:Array.from(e.entries())}:e instanceof Set?{type:"Set",data:Array.from(e)}:e&&e.buffer instanceof ArrayBuffer?{type:e.constructor.name,data:Array.from(e)}:e}function E(r,e){if("string"==typeof e){if(/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(e))return new Date(Date.parse(e))}else if(null!=e&&"object"==typeof e&&"string"==typeof e.type&&e.data){if("bigint"==e.type)return f.CastInt64(e.data);if("Map"==e.type)return new Map(e.data);if("Set"==e.type)return new Set(e.data);if(e.type.lastIndexOf("Array")>0)return new g[e.type](e.data)}return e}const g="object"==typeof window?window:global;r.JsonX=M,r.MsgArray=f,r.MsgClass=function(r,e){return function(t){f.MetaBind(t,r||i++,e||t.name,t.prototype[p]||[]),delete t.prototype[p]}},r.MsgField=function(r,e=0,t){return function(n,a){n[p]||(n[p]=[]),n[p].push([t||a.toString(),r,e])}},Object.defineProperty(r,"__esModule",{value:!0})}));
